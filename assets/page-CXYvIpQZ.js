import{a as q,u as D,r as n,j as e,s as p}from"./index-CQCmJ27i.js";function L(){const{profile:c,loading:d}=q(),f=D(),[v,k]=n.useState([]),[_,S]=n.useState(!0),[o,h]=n.useState("all"),[x,u]=n.useState(!1),[m,g]=n.useState(null),[y,l]=n.useState(""),[j,i]=n.useState(""),[r,a]=n.useState({title:"",description:"",content_type:"manual",url:""});if(n.useEffect(()=>{if(!d){if(c?.role!=="admin"){f("/user/dashboard");return}b()}},[c,d]),d)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})});const b=async()=>{try{const{data:t,error:s}=await p.from("manuals").select("*").order("created_at",{ascending:!1});if(s)throw s;k(t||[])}catch(t){console.error("マニュアル取得エラー:",t),l("マニュアルの取得に失敗しました。")}finally{S(!1)}},C=async t=>{if(t.preventDefault(),l(""),i(""),!!c)try{if(m){const{error:s}=await p.from("manuals").update({title:r.title,description:r.description||null,content_type:r.content_type,url:r.url,updated_at:new Date().toISOString()}).eq("id",m);if(s)throw s;i("マニュアルを更新しました！")}else{const{error:s}=await p.from("manuals").insert({title:r.title,description:r.description||null,content_type:r.content_type,url:r.url,created_by:c.id});if(s)throw s;i("マニュアルを登録しました！")}a({title:"",description:"",content_type:"manual",url:""}),g(null),u(!1),b()}catch(s){console.error("登録エラー:",s),l("登録に失敗しました。もう一度お試しください。")}},E=t=>{a({title:t.title,description:t.description||"",content_type:t.content_type,url:t.url}),g(t.id),u(!0),l(""),i("")},$=async t=>{if(confirm("このマニュアルを削除してもよろしいですか？"))try{const{error:s}=await p.from("manuals").delete().eq("id",t);if(s)throw s;i("マニュアルを削除しました。"),b()}catch(s){console.error("削除エラー:",s),l("削除に失敗しました。")}},w=()=>{a({title:"",description:"",content_type:"manual",url:""}),g(null),u(!1),l(""),i("")},N=v.filter(t=>o==="all"?!0:t.content_type===o);return d||_?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>f("/admin/dashboard"),className:"text-gray-600 hover:text-gray-900 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-2xl"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"マニュアル管理"})]}),e.jsx("button",{onClick:()=>{u(!x),x&&w()},className:"px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors font-medium whitespace-nowrap cursor-pointer",children:x?"キャンセル":"新規登録"})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[y&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:y}),j&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700",children:j}),x&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:m?"マニュアル編集":"マニュアル新規登録"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["タイトル ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.title,onChange:t=>a({...r,title:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm",placeholder:"マニュアルのタイトルを入力"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"説明"}),e.jsx("textarea",{value:r.description,onChange:t=>a({...r,description:t.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm resize-none",placeholder:"マニュアルの説明を入力"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["コンテンツタイプ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{required:!0,value:r.content_type,onChange:t=>a({...r,content_type:t.target.value}),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm appearance-none cursor-pointer",children:[e.jsx("option",{value:"manual",children:"マニュアルファイル"}),e.jsx("option",{value:"video",children:"動画コンテンツ"})]}),e.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[r.content_type==="manual"?"ファイルURL":"YouTube動画URL"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",required:!0,value:r.url,onChange:t=>a({...r,url:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm",placeholder:r.content_type==="manual"?"https://example.com/manual.pdf":"https://www.youtube.com/watch?v=..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors font-medium whitespace-nowrap cursor-pointer",children:m?"更新する":"登録する"}),e.jsx("button",{type:"button",onClick:w,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium whitespace-nowrap cursor-pointer",children:"キャンセル"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"登録済みマニュアル"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap cursor-pointer ${o==="all"?"bg-pink-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"すべて"}),e.jsx("button",{onClick:()=>h("manual"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap cursor-pointer ${o==="manual"?"bg-pink-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"ファイル"}),e.jsx("button",{onClick:()=>h("video"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap cursor-pointer ${o==="video"?"bg-pink-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"動画"})]})]}),N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-file-list-3-line text-6xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"マニュアルが登録されていません"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t.content_type==="manual"?"bg-blue-100":"bg-red-100"}`,children:e.jsx("i",{className:`${t.content_type==="manual"?"ri-file-text-line text-blue-600":"ri-video-line text-red-600"} text-xl`})}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t.content_type==="manual"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"}`,children:t.content_type==="manual"?"ファイル":"動画"})]})}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>E(t),className:"flex-1 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium whitespace-nowrap cursor-pointer",children:"編集"}),e.jsx("button",{onClick:()=>$(t.id),className:"flex-1 px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm font-medium whitespace-nowrap cursor-pointer",children:"削除"})]})]},t.id))})]})]})]})}export{L as default};
//# sourceMappingURL=page-CXYvIpQZ.js.map
