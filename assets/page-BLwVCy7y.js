import{a as v,u as k,r as a,j as e,s as c}from"./index-CQCmJ27i.js";function C(){const{profile:d,loading:x}=v(),u=k(),[h,f]=a.useState([]),[p,b]=a.useState(!0),[j,i]=a.useState(!1),[o,l]=a.useState(null),[s,n]=a.useState({title:"",content:""});if(a.useEffect(()=>{if(!x){if(d?.role!=="admin"){u("/user/dashboard");return}m()}},[d,x]),x)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})});const m=async()=>{const{data:t}=await c.from("announcements").select("*").order("created_at",{ascending:!1});t&&f(t),b(!1)},N=async t=>{if(t.preventDefault(),!s.title.trim()||!s.content.trim()){alert("タイトルと内容を入力してください");return}if(o){const{error:r}=await c.from("announcements").update({title:s.title,content:s.content,updated_at:new Date().toISOString()}).eq("id",o);if(r){console.error("更新エラー:",r),alert("更新に失敗しました");return}}else{const{error:r}=await c.from("announcements").insert({title:s.title,content:s.content,created_by:d?.id});if(r){console.error("作成エラー:",r),alert("作成に失敗しました");return}}i(!1),l(null),n({title:"",content:""}),m()},y=t=>{l(t.id),n({title:t.title,content:t.content}),i(!0)},w=async t=>{if(!confirm("このお知らせを削除しますか？"))return;const{error:r}=await c.from("announcements").delete().eq("id",t);if(r){console.error("削除エラー:",r),alert("削除に失敗しました");return}m()},g=()=>{l(null),n({title:"",content:""}),i(!0)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>u("/admin/dashboard"),className:"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"連絡掲示板"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"お知らせの管理"})]})]}),e.jsxs("button",{onClick:g,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"新規作成"]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"読み込み中..."})]}):h.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-notification-line text-3xl text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"お知らせがありません"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"新しいお知らせを作成してください"}),e.jsxs("button",{onClick:g,className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"新規作成"]})]}):e.jsx("div",{className:"grid gap-4",children:h.map(t=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-notification-line text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.content})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(t),className:"w-10 h-10 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded-lg transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-edit-line text-xl"})}),e.jsx("button",{onClick:()=>w(t.id),className:"w-10 h-10 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-delete-bin-line text-xl"})})]})]})},t.id))})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:o?"お知らせを編集":"新しいお知らせ"}),e.jsx("button",{onClick:()=>{i(!1),l(null),n({title:"",content:""})},className:"w-10 h-10 flex items-center justify-center text-gray-400 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]})}),e.jsxs("form",{onSubmit:N,className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["タイトル ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.title,onChange:t=>n({...s,title:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"お知らせのタイトルを入力",required:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["内容 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:s.content,onChange:t=>n({...s,content:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm resize-none",rows:8,placeholder:"お知らせの内容を入力",required:!0})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),l(null),n({title:"",content:""})},className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium whitespace-nowrap cursor-pointer",children:"キャンセル"}),e.jsx("button",{type:"submit",className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium whitespace-nowrap cursor-pointer",children:o?"更新する":"作成する"})]})]})]})})]})}export{C as default};
//# sourceMappingURL=page-BLwVCy7y.js.map
