import{a as C,u as J,r as x,s as h,j as e}from"./index-CQCmJ27i.js";const v=(l=new Date)=>{const c=new Date(l.toLocaleString("en-US",{timeZone:"Asia/Tokyo"})),u=c.getFullYear(),g=String(c.getMonth()+1).padStart(2,"0"),s=String(c.getDate()).padStart(2,"0");return`${u}-${g}-${s}`};function F(){const{profile:l}=C(),c=J(),[u,g]=x.useState(!1),[s,y]=x.useState(new Date),[o,S]=x.useState([]),[m,D]=x.useState(null);x.useEffect(()=>{j()},[s,l]);const j=async()=>{if(!l)return;const t=s.getFullYear(),r=s.getMonth(),n=`${t}-${String(r+1).padStart(2,"0")}-01`,i=`${t}-${String(r+1).padStart(2,"0")}-${String(new Date(t,r+1,0).getDate()).padStart(2,"0")}`;console.log("勤怠データ取得中...",{startDate:n,endDate:i,userId:l.id});const{data:a,error:p}=await h.from("attendance").select("*").eq("user_id",l.id).gte("date",n).lte("date",i).order("date",{ascending:!1});if(p){console.error("勤怠データ取得エラー:",p);return}if(console.log("取得した勤怠データ:",a),a){S(a);const b=v();console.log("今日の日付:",b);const N=a.find(w=>(console.log("比較:",w.date,"vs",b),w.date===b));console.log("今日の勤怠データ:",N),D(N||null)}},_=async t=>{if(!l)return;g(!0);const r=v();console.log("勤怠記録開始:",{today:r,status:t,userId:l.id});try{const{data:n,error:i}=await h.from("attendance").select("*").eq("user_id",l.id).eq("date",r).maybeSingle();if(i)throw console.error("既存データ確認エラー:",i),i;console.log("既存データ:",n);let a;if(n?(console.log("データを更新中..."),a=await h.from("attendance").update({status:t,updated_at:new Date().toISOString()}).eq("id",n.id).select()):(console.log("新しいデータを作成中..."),a=await h.from("attendance").insert({user_id:l.id,date:r,status:t}).select()),console.log("保存結果:",a),a.error)throw console.error("保存エラー:",a.error),a.error;console.log("データを再取得中..."),await j(),console.log("勤怠記録完了"),alert("勤怠を記録しました")}catch(n){console.error("勤怠登録エラー:",n),alert("勤怠の登録に失敗しました。もう一度お試しください。")}finally{g(!1)}},f=t=>({normal:"出勤→通常",early_leave:"出勤→早退",late_normal:"遅刻→通常",late_early:"遅刻→早退",absent:"欠勤"})[t]||t,$=t=>({normal:"bg-green-100 text-green-700",early_leave:"bg-yellow-100 text-yellow-700",late_normal:"bg-orange-100 text-orange-700",late_early:"bg-red-100 text-red-700",absent:"bg-gray-100 text-gray-700"})[t]||"bg-gray-100 text-gray-700",k=[{status:"normal",label:"出勤→通常",icon:"ri-check-line",color:"bg-green-500 hover:bg-green-600"},{status:"early_leave",label:"出勤→早退",icon:"ri-arrow-left-line",color:"bg-yellow-500 hover:bg-yellow-600"},{status:"late_normal",label:"遅刻→通常",icon:"ri-time-line",color:"bg-orange-500 hover:bg-orange-600"},{status:"late_early",label:"遅刻→早退",icon:"ri-arrow-left-right-line",color:"bg-red-500 hover:bg-red-600"},{status:"absent",label:"欠勤",icon:"ri-close-line",color:"bg-gray-500 hover:bg-gray-600"}],d={normal:o.filter(t=>t.status==="normal").length,early_leave:o.filter(t=>t.status==="early_leave").length,late_normal:o.filter(t=>t.status==="late_normal").length,late_early:o.filter(t=>t.status==="late_early").length,absent:o.filter(t=>t.status==="absent").length},L=()=>{y(new Date(s.getFullYear(),s.getMonth()-1))},M=()=>{y(new Date(s.getFullYear(),s.getMonth()+1))},A=t=>({normal:"bg-green-500",early_leave:"bg-yellow-500",late_normal:"bg-orange-500",late_early:"bg-red-500",absent:"bg-gray-500"})[t]||"bg-white/20";return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c("/user/dashboard"),className:"w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-xl text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"勤怠管理"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"出勤・退勤を記録"})]})]})})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl p-6 text-white mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"今日の日付"}),e.jsx("p",{className:"text-2xl font-bold",children:new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Tokyo"})).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-time-line text-3xl"})})]}),m&&e.jsxs("div",{className:`${A(m.status)} rounded-lg p-3`,children:[e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"本日の勤怠状況"}),e.jsx("p",{className:"text-lg font-bold",children:f(m.status)}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:["記録日時: ",new Date(m.created_at).toLocaleString("ja-JP")]})]})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"本日の勤怠を記録"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:k.map(t=>e.jsx("button",{onClick:()=>_(t.status),disabled:u,className:`${t.color} text-white rounded-xl p-6 shadow-sm hover:shadow-md transition-all cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap`,children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("i",{className:`${t.icon} text-2xl`})}),e.jsx("span",{className:"font-bold text-sm",children:t.label})]})},t.status))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"今月の統計"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-check-line text-green-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:d.normal})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"出勤→通常"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-arrow-left-line text-yellow-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:d.early_leave})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"出勤→早退"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-time-line text-orange-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:d.late_normal})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"遅刻→通常"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-arrow-left-right-line text-red-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:d.late_early})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"遅刻→早退"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-close-line text-gray-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:d.absent})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"欠勤"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"勤怠履歴"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:L,className:"w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-s-line text-xl text-gray-600"})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 min-w-[120px] text-center",children:[s.getFullYear(),"年",s.getMonth()+1,"月"]}),e.jsx("button",{onClick:M,className:"w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-right-s-line text-xl text-gray-600"})})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:o.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"この月の勤怠記録はありません"}):e.jsx("div",{className:"divide-y divide-gray-100",children:o.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Date(t.date).getDate()}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.date).toLocaleDateString("ja-JP",{weekday:"short"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:new Date(t.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}),e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${$(t.status)}`,children:f(t.status)})]})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["登録: ",new Date(t.created_at).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]})]})},t.id))})})]})]})]})}export{F as default};
//# sourceMappingURL=page-Bbrup95g.js.map
