import{a as k,u as C,r as a,s as d,j as e}from"./index-CQCmJ27i.js";function q(){const{profile:i}=k(),m=C(),[u,f]=a.useState([]),[b,h]=a.useState(!0),[j,l]=a.useState(!1),[c,o]=a.useState(null),[r,n]=a.useState({title:"",content:""});a.useEffect(()=>{if(i?.role!=="user"){m("/admin/dashboard");return}x()},[i]);const x=async()=>{if(!i?.id)return;h(!0);const{data:t,error:s}=await d.from("consultations").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});s?console.error("相談データ取得エラー:",s):t&&f(t),h(!1)},y=async t=>{if(t.preventDefault(),!r.title.trim()||!r.content.trim()){alert("タイトルと内容を入力してください");return}if(c){const{error:s}=await d.from("consultations").update({title:r.title,content:r.content,updated_at:new Date().toISOString()}).eq("id",c);if(s){console.error("更新エラー:",s),alert("更新に失敗しました");return}}else{const{error:s}=await d.from("consultations").insert({user_id:i?.id,title:r.title,content:r.content,status:"pending"});if(s){console.error("送信エラー:",s),alert("送信に失敗しました");return}}l(!1),o(null),n({title:"",content:""}),x()},N=t=>{o(t.id),n({title:t.title,content:t.content}),l(!0)},w=async t=>{if(!confirm("この相談を削除しますか？"))return;const{error:s}=await d.from("consultations").delete().eq("id",t);if(s){console.error("削除エラー:",s),alert("削除に失敗しました");return}x()},v=t=>{const p={pending:{label:"未対応",color:"bg-gray-100 text-gray-700"},in_progress:{label:"対応中",color:"bg-blue-100 text-blue-700"},resolved:{label:"解決済み",color:"bg-green-100 text-green-700"}}[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${p.color}`,children:p.label})},g=()=>{o(null),n({title:"",content:""}),l(!0)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("/user/dashboard"),className:"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"相談窓口"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"お困りごとをご相談ください"})]})]}),e.jsxs("button",{onClick:g,className:"px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors font-medium whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"新規相談"]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-pink-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"読み込み中..."})]}):u.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-question-answer-line text-3xl text-pink-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"相談履歴がありません"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"お困りごとがあればお気軽にご相談ください"}),e.jsxs("button",{onClick:g,className:"px-6 py-3 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors font-medium whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"新規相談を送信"]})]}):e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 flex-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[v(t.status),e.jsx("button",{onClick:()=>N(t),className:"w-10 h-10 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded-lg transition-colors cursor-pointer",title:"編集",children:e.jsx("i",{className:"ri-edit-line text-xl"})}),e.jsx("button",{onClick:()=>w(t.id),className:"w-10 h-10 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors cursor-pointer",title:"削除",children:e.jsx("i",{className:"ri-delete-bin-line text-xl"})})]})]}),e.jsx("p",{className:"text-gray-700 mb-4 whitespace-pre-wrap",children:t.content}),e.jsx("div",{className:"flex items-center justify-between text-sm text-gray-500",children:e.jsxs("span",{children:[e.jsx("i",{className:"ri-calendar-line mr-1"}),new Date(t.created_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})]})})]},t.id))})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:c?"相談内容を編集":"新しい相談"}),e.jsx("button",{onClick:()=>{l(!1),o(null),n({title:"",content:""})},className:"w-10 h-10 flex items-center justify-center text-gray-400 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]})}),e.jsxs("form",{onSubmit:y,className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["タイトル ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.title,onChange:t=>n({...r,title:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm",placeholder:"相談のタイトルを入力",required:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["相談内容 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:r.content,onChange:t=>n({...r,content:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm resize-none",rows:8,placeholder:"相談内容を詳しく入力してください",required:!0})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{l(!1),o(null),n({title:"",content:""})},className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium whitespace-nowrap cursor-pointer",children:"キャンセル"}),e.jsx("button",{type:"submit",className:"px-6 py-3 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors font-medium whitespace-nowrap cursor-pointer",children:c?"更新する":"送信する"})]})]})]})})]})}export{q as default};
//# sourceMappingURL=page-B17nXA_P.js.map
