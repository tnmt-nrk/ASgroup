import{a as D,u as L,r as o,j as e,s as w}from"./index-CQCmJ27i.js";function J(){const{profile:u,loading:x}=D(),p=L(),[n,N]=o.useState([]),[v,k]=o.useState(!0),[s,m]=o.useState(null),[a,c]=o.useState("all");if(o.useEffect(()=>{if(!x){if(u?.role!=="admin"){p("/user/dashboard");return}h()}},[u,x]),x)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})});const h=async()=>{const{data:t}=await w.from("consultations").select(`
        *,
        profiles:user_id (
          username,
          furigana
        )
      `).order("created_at",{ascending:!1});t&&N(t),k(!1)},g=async(t,r)=>{const{error:l}=await w.from("consultations").update({status:r,updated_at:new Date().toISOString()}).eq("id",t);l||(h(),s?.id===t&&m({...s,status:r}))},b=t=>{const r={pending:{label:"未対応",color:"bg-yellow-100 text-yellow-800"},in_progress:{label:"対応中",color:"bg-blue-100 text-blue-800"},resolved:{label:"解決済み",color:"bg-green-100 text-green-800"}},l=r[t]||r.pending;return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${l.color}`,children:l.label})},C=t=>({pending:"未対応",in_progress:"対応中",resolved:"解決済み"})[t]||"未対応",f=t=>{const r=new Date().toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit"}),_=`
================================================================================
                              相談窓口報告書
================================================================================

【基本情報】
--------------------------------------------------------------------------------
相談日時: ${new Date(t.created_at).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}
対応状況: ${C(t.status)}

【利用者情報】
--------------------------------------------------------------------------------
氏名: ${t.profiles?.username||"不明"}
ふりがな: ${t.profiles?.furigana||"不明"}

【相談内容】
--------------------------------------------------------------------------------
タイトル: ${t.title}

内容:
${t.content}

================================================================================
発行日: ${r}
================================================================================
`.trim(),S=new Blob([_],{type:"text/plain;charset=utf-8"}),y=URL.createObjectURL(S),i=document.createElement("a");i.href=y;const $=`相談報告書_${t.profiles?.username||"利用者"}_${new Date(t.created_at).toLocaleDateString("ja-JP").replace(/\//g,"-")}.txt`;i.download=$,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(y)},j=n.filter(t=>a==="all"?!0:t.status===a),d={all:n.length,pending:n.filter(t=>t.status==="pending").length,in_progress:n.filter(t=>t.status==="in_progress").length,resolved:n.filter(t=>t.status==="resolved").length};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>p("/admin/dashboard"),className:"w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-xl text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"相談窓口管理"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"利用者からの相談を確認・対応"})]})]})})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap cursor-pointer transition-colors ${a==="all"?"bg-pink-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"}`,children:["すべて (",d.all,")"]}),e.jsxs("button",{onClick:()=>c("pending"),className:`px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap cursor-pointer transition-colors ${a==="pending"?"bg-yellow-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"}`,children:["未対応 (",d.pending,")"]}),e.jsxs("button",{onClick:()=>c("in_progress"),className:`px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap cursor-pointer transition-colors ${a==="in_progress"?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"}`,children:["対応中 (",d.in_progress,")"]}),e.jsxs("button",{onClick:()=>c("resolved"),className:`px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap cursor-pointer transition-colors ${a==="resolved"?"bg-green-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"}`,children:["解決済み (",d.resolved,")"]})]})}),v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-pink-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"読み込み中..."})]}):j.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-question-answer-line text-3xl text-pink-500"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"相談はありません"}),e.jsx("p",{className:"text-gray-600",children:"該当する相談が見つかりませんでした"})]}):e.jsx("div",{className:"space-y-4",children:j.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.title}),b(t.status)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("i",{className:"ri-user-line mr-1"}),"利用者: ",t.profiles?.username," (",t.profiles?.furigana,")"]})]}),e.jsx("button",{onClick:()=>m(t),className:"px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors text-sm font-medium whitespace-nowrap cursor-pointer",children:"詳細を見る"})]}),e.jsx("p",{className:"text-gray-700 mb-4 line-clamp-2",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[e.jsx("i",{className:"ri-time-line mr-1"}),new Date(t.created_at).toLocaleString("ja-JP")]}),e.jsx("button",{onClick:()=>f(t),className:"w-8 h-8 flex items-center justify-center rounded-lg bg-green-500 hover:bg-green-600 text-white transition-colors cursor-pointer",title:"報告書をダウンロード",children:e.jsx("i",{className:"ri-download-line text-lg"})})]})]},t.id))})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"相談詳細"}),e.jsx("button",{onClick:()=>m(null),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-600"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"利用者"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.profiles?.username," (",s.profiles?.furigana,")"]})]}),b(s.status)]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"相談日時"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(s.created_at).toLocaleString("ja-JP")})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:s.title}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.content})})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"対応状況を変更"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>g(s.id,"pending"),className:`flex-1 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap cursor-pointer transition-colors ${s.status==="pending"?"bg-yellow-500 text-white":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"}`,children:"未対応"}),e.jsx("button",{onClick:()=>g(s.id,"in_progress"),className:`flex-1 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap cursor-pointer transition-colors ${s.status==="in_progress"?"bg-blue-500 text-white":"bg-blue-100 text-blue-800 hover:bg-blue-200"}`,children:"対応中"}),e.jsx("button",{onClick:()=>g(s.id,"resolved"),className:`flex-1 px-4 py-3 rounded-lg font-medium text-sm whitespace-nowrap cursor-pointer transition-colors ${s.status==="resolved"?"bg-green-500 text-white":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:"解決済み"})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-6 mt-6",children:e.jsxs("button",{onClick:()=>f(s),className:"w-full px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium whitespace-nowrap cursor-pointer flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-download-line text-lg"}),"報告書をダウンロード"]})})]})]})})]})}export{J as default};
//# sourceMappingURL=page-Dcp-9-F9.js.map
