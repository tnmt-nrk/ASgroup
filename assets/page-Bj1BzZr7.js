import{u as N,r as c,j as e,s as g}from"./index-CQCmJ27i.js";function C(){const f=N(),[p,x]=c.useState(!0),[u,o]=c.useState(!1),[b,a]=c.useState(""),[h,m]=c.useState(""),[i,y]=c.useState({email:"",password:""}),[r,n]=c.useState({username:"",furigana:"",email:"",password:"",confirmPassword:"",role:"user",phone:""}),j=async s=>{s.preventDefault(),o(!0),a("");try{const{data:l,error:t}=await g.auth.signInWithPassword({email:i.email,password:i.password});if(t){console.error("ログインエラー:",t),t.message.includes("Invalid login credentials")?a("メールアドレスまたはパスワードが正しくありません。"):t.message.includes("Email not confirmed")?a("メールアドレスが確認されていません。確認メールをご確認ください。"):a(`ログインエラー: ${t.message}`),o(!1);return}if(l.user){console.log("ログイン成功:",l.user.id);const{data:d,error:w}=await g.from("profiles").select("role").eq("id",l.user.id).single();if(w){console.error("プロフィール取得エラー:",w),a("ユーザー情報の取得に失敗しました。管理者にお問い合わせください。"),o(!1);return}console.log("プロフィール取得成功:",d),setTimeout(()=>{d?.role==="admin"?f("/admin/dashboard",{replace:!0}):f("/user/dashboard",{replace:!0}),o(!1)},100)}}catch(l){console.error("予期しないエラー:",l),a("ログイン処理中にエラーが発生しました。もう一度お試しください。"),o(!1)}},v=async s=>{if(s.preventDefault(),o(!0),a(""),m(""),r.password!==r.confirmPassword){a("パスワードが一致しません。"),o(!1);return}if(r.password.length<6){a("パスワードは6文字以上で設定してください。"),o(!1);return}try{const{data:l,error:t}=await g.auth.signUp({email:r.email,password:r.password,options:{data:{username:r.username,furigana:r.furigana},emailRedirectTo:void 0}});if(t){console.error("登録エラー:",t),t.message.includes("User already registered")?a("このメールアドレスは既に登録されています。ログインしてください。"):t.message.includes("Password should be at least")?a("パスワードは6文字以上で設定してください。"):t.message.includes("Invalid email")?a("有効なメールアドレスを入力してください。"):a("登録に失敗しました: "+t.message),o(!1);return}if(l.user){console.log("ユーザー作成成功:",l.user.id);const{error:d}=await g.from("profiles").insert({id:l.user.id,username:r.username,furigana:r.furigana,email:r.email,role:r.role,phone:r.phone||null});if(d){console.error("プロフィール作成エラー:",d),a("プロフィール登録に失敗しました: "+d.message),o(!1);return}console.log("プロフィール作成成功"),m("登録が完了しました！ログインしてください。"),x(!0),n({username:"",furigana:"",email:"",password:"",confirmPassword:"",role:"user",phone:""})}}catch(l){console.error("予期しないエラー:",l),a("登録処理中にエラーが発生しました。")}finally{o(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4 py-12",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"アルファサービス"}),e.jsx("p",{className:"text-gray-600",children:"就労継続支援A型事業所 管理システム"})]}),e.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>{x(!0),a(""),m("")},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all whitespace-nowrap cursor-pointer ${p?"bg-white text-indigo-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"ログイン"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),a(""),m("")},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all whitespace-nowrap cursor-pointer ${p?"text-gray-600 hover:text-gray-900":"bg-white text-indigo-600 shadow-sm"}`,children:"新規登録"})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:b}),h&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700 text-sm",children:h}),p?e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メールアドレス"}),e.jsx("input",{type:"email",required:!0,value:i.email,onChange:s=>y({...i,email:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"example@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"パスワード"}),e.jsx("input",{type:"password",required:!0,value:i.password,onChange:s=>y({...i,password:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"••••••••"})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:u?"ログイン中...":"ログイン"})]}):e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ユーザー名 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.username,onChange:s=>n({...r,username:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"山田太郎"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ふりがな ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.furigana,onChange:s=>n({...r,furigana:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"やまだたろう"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["メールアドレス ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",required:!0,value:r.email,onChange:s=>n({...r,email:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"example@email.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["パスワード ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",required:!0,value:r.password,onChange:s=>n({...r,password:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"6文字以上"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["パスワード確認 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",required:!0,value:r.confirmPassword,onChange:s=>n({...r,confirmPassword:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"パスワードを再入力"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["権限 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{required:!0,value:r.role,onChange:s=>n({...r,role:s.target.value}),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm appearance-none cursor-pointer",children:[e.jsx("option",{value:"user",children:"利用者"}),e.jsx("option",{value:"admin",children:"管理者"})]}),e.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"携帯番号"}),e.jsx("input",{type:"tel",value:r.phone,onChange:s=>n({...r,phone:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"090-1234-5678"})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:u?"登録中...":"新規登録"})]})]})})})}export{C as default};
//# sourceMappingURL=page-Bj1BzZr7.js.map
