import{a as L,u as M,r,j as e,s as h}from"./index-CQCmJ27i.js";function z(){const{profile:a,loading:x}=L(),g=M(),[f,N]=r.useState([]),[w,b]=r.useState(!0),[v,c]=r.useState(!1),[m,j]=r.useState(null),[k,d]=r.useState(!1),[i,o]=r.useState(null),[u,y]=r.useState(!1),[t,l]=r.useState({username:"",furigana:"",email:"",phone:"",role:"user"});if(r.useEffect(()=>{if(!x){if(a?.role!=="admin"){g("/user/dashboard");return}p()}},[a,x]),x)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})});const p=async()=>{b(!0);const{data:s,error:n}=await h.from("profiles").select("*").order("created_at",{ascending:!1});n?console.error("ユーザー取得エラー:",n):s&&N(s),b(!1)},C=s=>{j(s),l({username:s.username,furigana:s.furigana,email:s.email,phone:s.phone||"",role:s.role}),c(!0)},S=s=>{if(s.id===a?.id){alert("自分自身のアカウントは削除できません。");return}o(s),d(!0)},D=async()=>{if(i){if(i.id===a?.id){alert("自分自身のアカウントは削除できません。"),d(!1),o(null);return}y(!0);try{const{error:s}=await h.from("profiles").delete().eq("id",i.id);s?(console.error("ユーザー削除エラー:",s),alert("ユーザーの削除に失敗しました。")):(alert("ユーザーを削除しました。"),d(!1),o(null),await p())}catch(s){console.error("削除エラー:",s),alert("ユーザーの削除に失敗しました。")}finally{y(!1)}}},E=async s=>{if(s.preventDefault(),!!m)try{const{error:n}=await h.from("profiles").update({username:t.username,furigana:t.furigana,email:t.email,phone:t.phone,role:t.role,updated_at:new Date().toISOString()}).eq("id",m.id);n?(console.error("更新エラー:",n),alert("ユーザー情報の更新に失敗しました。")):(alert("ユーザー情報を更新しました。"),c(!1),j(null),await p())}catch(n){console.error("更新エラー:",n),alert("ユーザー情報の更新に失敗しました。")}},U=s=>s==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700",q=s=>s==="admin"?"管理者":"一般ユーザー";return w?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g("/admin/dashboard"),className:"w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-xl text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ユーザー管理"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ユーザー情報の管理"})]})]})})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"登録ユーザー一覧"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["全",f.length,"名"]})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"氏名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"メールアドレス"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"電話番号"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"権限"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:f.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.username}),e.jsx("p",{className:"text-xs text-gray-500",children:s.furigana})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("p",{className:"text-sm text-gray-900",children:s.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("p",{className:"text-sm text-gray-900",children:s.phone||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${U(s.role)}`,children:q(s.role)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>C(s),className:"w-9 h-9 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded-lg transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-edit-line text-lg"})}),e.jsx("button",{onClick:()=>S(s),disabled:s.id===a?.id,className:`w-9 h-9 flex items-center justify-center rounded-lg transition-colors ${s.id===a?.id?"text-gray-300 cursor-not-allowed":"text-red-600 hover:bg-red-50 cursor-pointer"}`,title:s.id===a?.id?"自分自身は削除できません":"削除",children:e.jsx("i",{className:"ri-delete-bin-line text-lg"})})]})})]},s.id))})]})})]})}),v&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"ユーザー情報編集"}),e.jsx("button",{onClick:()=>c(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-600"})})]})}),e.jsxs("form",{onSubmit:E,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"氏名"}),e.jsx("input",{type:"text",value:t.username,onChange:s=>l({...t,username:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ふりがな"}),e.jsx("input",{type:"text",value:t.furigana,onChange:s=>l({...t,furigana:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>l({...t,email:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"電話番号"}),e.jsx("input",{type:"tel",value:t.phone,onChange:s=>l({...t,phone:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"権限"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"user",checked:t.role==="user",onChange:s=>l({...t,role:s.target.value}),className:"w-4 h-4 text-blue-600 cursor-pointer"}),e.jsx("span",{className:"text-sm text-gray-700",children:"一般ユーザー"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"admin",checked:t.role==="admin",onChange:s=>l({...t,role:s.target.value}),className:"w-4 h-4 text-blue-600 cursor-pointer"}),e.jsx("span",{className:"text-sm text-gray-700",children:"管理者"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap",children:"キャンセル"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap",children:"更新"})]})]})]})}),k&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-alert-line text-2xl text-red-600"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-2",children:"ユーザーを削除しますか？"}),e.jsxs("p",{className:"text-sm text-gray-600 text-center mb-6",children:[i.username,"さんのアカウントを削除します。この操作は取り消せません。"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{d(!1),o(null)},disabled:u,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:"キャンセル"}),e.jsx("button",{type:"button",onClick:D,disabled:u,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:u?"削除中...":"削除"})]})]})})})]})}export{z as default};
//# sourceMappingURL=page-DO_EaG-2.js.map
