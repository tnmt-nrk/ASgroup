{"version":3,"file":"page-BLwVCy7y.js","sources":["../../src/pages/admin/announcements/page.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useAuth } from '../../../contexts/AuthContext';\nimport { supabase, Announcement } from '../../../lib/supabase';\nimport { useNavigate } from 'react-router-dom';\n\nexport default function AdminAnnouncements() {\n  const { profile, loading: authLoading } = useAuth();\n  const navigate = useNavigate();\n  const [announcements, setAnnouncements] = useState<Announcement[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showModal, setShowModal] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [formData, setFormData] = useState({\n    title: '',\n    content: '',\n  });\n\n  useEffect(() => {\n    // 認証状態の読み込みが完了するまで待つ\n    if (authLoading) return;\n\n    if (profile?.role !== 'admin') {\n      navigate('/user/dashboard');\n      return;\n    }\n    fetchAnnouncements();\n  }, [profile, authLoading]);\n\n  // 認証状態の読み込み中は何も表示しない\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">読み込み中...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const fetchAnnouncements = async () => {\n    const { data } = await supabase\n      .from('announcements')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (data) {\n      setAnnouncements(data);\n    }\n    setLoading(false);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.title.trim() || !formData.content.trim()) {\n      alert('タイトルと内容を入力してください');\n      return;\n    }\n\n    if (editingId) {\n      const { error } = await supabase\n        .from('announcements')\n        .update({\n          title: formData.title,\n          content: formData.content,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', editingId);\n\n      if (error) {\n        console.error('更新エラー:', error);\n        alert('更新に失敗しました');\n        return;\n      }\n    } else {\n      const { error } = await supabase\n        .from('announcements')\n        .insert({\n          title: formData.title,\n          content: formData.content,\n          created_by: profile?.id,\n        });\n\n      if (error) {\n        console.error('作成エラー:', error);\n        alert('作成に失敗しました');\n        return;\n      }\n    }\n\n    setShowModal(false);\n    setEditingId(null);\n    setFormData({ title: '', content: '' });\n    fetchAnnouncements();\n  };\n\n  const handleEdit = (announcement: Announcement) => {\n    setEditingId(announcement.id);\n    setFormData({\n      title: announcement.title,\n      content: announcement.content,\n    });\n    setShowModal(true);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('このお知らせを削除しますか？')) return;\n\n    const { error } = await supabase\n      .from('announcements')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      console.error('削除エラー:', error);\n      alert('削除に失敗しました');\n      return;\n    }\n\n    fetchAnnouncements();\n  };\n\n  const openNewModal = () => {\n    setEditingId(null);\n    setFormData({ title: '', content: '' });\n    setShowModal(true);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <header className=\"bg-white shadow-sm\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <button\n                onClick={() => navigate('/admin/dashboard')}\n                className=\"w-10 h-10 flex items-center justify-center text-gray-600 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer\"\n              >\n                <i className=\"ri-arrow-left-line text-xl\"></i>\n              </button>\n              <div>\n                <h1 className=\"text-2xl font-bold text-gray-900\">連絡掲示板</h1>\n                <p className=\"text-sm text-gray-600 mt-1\">お知らせの管理</p>\n              </div>\n            </div>\n            <button\n              onClick={openNewModal}\n              className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium whitespace-nowrap cursor-pointer\"\n            >\n              <i className=\"ri-add-line mr-2\"></i>\n              新規作成\n            </button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {loading ? (\n          <div className=\"text-center py-12\">\n            <div className=\"inline-block w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin\"></div>\n            <p className=\"mt-4 text-gray-600\">読み込み中...</p>\n          </div>\n        ) : announcements.length === 0 ? (\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center\">\n            <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <i className=\"ri-notification-line text-3xl text-gray-400\"></i>\n            </div>\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">お知らせがありません</h3>\n            <p className=\"text-gray-600 mb-6\">新しいお知らせを作成してください</p>\n            <button\n              onClick={openNewModal}\n              className=\"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium whitespace-nowrap cursor-pointer\"\n            >\n              <i className=\"ri-add-line mr-2\"></i>\n              新規作成\n            </button>\n          </div>\n        ) : (\n          <div className=\"grid gap-4\">\n            {announcements.map((announcement) => (\n              <div key={announcement.id} className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-3 mb-3\">\n                      <div className=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center\">\n                        <i className=\"ri-notification-line text-purple-600\"></i>\n                      </div>\n                      <div>\n                        <h3 className=\"text-lg font-bold text-gray-900\">{announcement.title}</h3>\n                        <p className=\"text-xs text-gray-500\">\n                          {new Date(announcement.created_at).toLocaleDateString('ja-JP', {\n                            year: 'numeric',\n                            month: 'long',\n                            day: 'numeric',\n                            hour: '2-digit',\n                            minute: '2-digit',\n                          })}\n                        </p>\n                      </div>\n                    </div>\n                    <p className=\"text-gray-700 whitespace-pre-wrap\">{announcement.content}</p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => handleEdit(announcement)}\n                      className=\"w-10 h-10 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded-lg transition-colors cursor-pointer\"\n                    >\n                      <i className=\"ri-edit-line text-xl\"></i>\n                    </button>\n                    <button\n                      onClick={() => handleDelete(announcement.id)}\n                      className=\"w-10 h-10 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors cursor-pointer\"\n                    >\n                      <i className=\"ri-delete-bin-line text-xl\"></i>\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </main>\n\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-100\">\n              <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-xl font-bold text-gray-900\">\n                  {editingId ? 'お知らせを編集' : '新しいお知らせ'}\n                </h2>\n                <button\n                  onClick={() => {\n                    setShowModal(false);\n                    setEditingId(null);\n                    setFormData({ title: '', content: '' });\n                  }}\n                  className=\"w-10 h-10 flex items-center justify-center text-gray-400 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer\"\n                >\n                  <i className=\"ri-close-line text-2xl\"></i>\n                </button>\n              </div>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\"p-6\">\n              <div className=\"mb-6\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  タイトル <span className=\"text-red-500\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.title}\n                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm\"\n                  placeholder=\"お知らせのタイトルを入力\"\n                  required\n                />\n              </div>\n\n              <div className=\"mb-6\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  内容 <span className=\"text-red-500\">*</span>\n                </label>\n                <textarea\n                  value={formData.content}\n                  onChange={(e) => setFormData({ ...formData, content: e.target.value })}\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm resize-none\"\n                  rows={8}\n                  placeholder=\"お知らせの内容を入力\"\n                  required\n                />\n              </div>\n\n              <div className=\"flex gap-3 justify-end\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowModal(false);\n                    setEditingId(null);\n                    setFormData({ title: '', content: '' });\n                  }}\n                  className=\"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium whitespace-nowrap cursor-pointer\"\n                >\n                  キャンセル\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium whitespace-nowrap cursor-pointer\"\n                >\n                  {editingId ? '更新する' : '作成する'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["AdminAnnouncements","profile","authLoading","useAuth","navigate","useNavigate","announcements","setAnnouncements","useState","loading","setLoading","showModal","setShowModal","editingId","setEditingId","formData","setFormData","useEffect","fetchAnnouncements","jsxs","jsx","data","supabase","handleSubmit","e","error","handleEdit","announcement","handleDelete","id","openNewModal"],"mappings":"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"}